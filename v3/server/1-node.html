

<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <title>node - mallow</title>
  <meta charset="utf-8">
  <meta name="description" content="mallow's blog.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:type" content="article">
  <meta property="og:title" content="node — mallow">
  <meta property="og:description" content="mallow's blog.">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-120215204-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-120215204-1');
  </script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="icon" href="/images/logo.png" type="image/png">
  <!-- main page styles -->
  <link rel="stylesheet" href="/css/page.css">
  <!-- import vue from there so that you can use vue in markdown -->
  <script src="/js/vue.min.js"></script>
  <script>window.PAGE_TYPE = "v3/server"</script>
</head>
<body class="docs">
  <div id="mobile-bar">
    <a class="menu-button"></a>
    <a class="logo" href="/"></a>
  </div>
  <div id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png">
    <span>Mallow</span>
  </a>
  <ul id="nav">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>

<!-- v3 directory -->
<!-- <li class="nav-dropdown-container learn">
  <a href="/v3/client/index.html" class="nav-link">客户端</a>
</li>

<li class="nav-dropdown-container learn">
  <a href="/v3/http/index.html" class="nav-link">HTTP</a>
</li>

<li class="nav-dropdown-container learn">
  <a href="/v3/server/index.html" class="nav-link">服务端</a>
</li>
 -->

<!-- v2 directory -->
<li class="nav-dropdown-container learn">
  <a class="nav-link">理论</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/theory/dataStructure/1_intro.html" class="nav-link">数据结构</a></li>
    <li><a href="/v2/theory/computerNet/1_intro.html" class="nav-link">计算机网络</a></li>
    <li><a href="/v2/theory/computerContain/1_intro.html" class="nav-link">计算机组成原理</a></li>
    <li><a href="/v2/theory/arithmeticV2/1_intro.html" class="nav-link">算法</a></li>
    <li><a href="/v2/theory/compile/1_intro.html" class="nav-link">编译原理</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">基础</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/basic/frontend/1_intro.html" class="nav-link">前端</a></li>
    <li><a href="/v2/basic/http/1_intro.html" class="nav-link">http</a></li>
    <li><a href="/v2/basic/backend/1_intro.html" class="nav-link">后端</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">框架</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/frame/react/1_intro.html" class="nav-link">React相关</a></li>
    <li><a href="/v2/theory/vue/1_intro.html" class="nav-link">Vue相关</a></li>
    <li><a href="/v2/theory/lodash/1_intro.html" class="nav-link">Lodash</a></li>
    <li><a href="/v2/theory/axios/1_intro.html" class="nav-link">axios</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
    <a class="nav-link">开发</a><span class="arrow"></span>
    <ul class="nav-dropdown">
      <li><a href="/v2/dev/ide/1_intro.html" class="nav-link">IDE</a></li>
      <li><a href="/v2/dev/codeManage/1_intro.html" class="nav-link">代码管理</a></li>
      <li><a href="/v2/dev/packTools/1_intro.html" class="nav-link">打包工具</a></li>
      <li><a href="/v2/dev/staging/1_intro.html" class="nav-link">脚手架</a></li>
      <li><a href="/v2/dev/debug/1_intro.html" class="nav-link">debug</a></li>
      <li><a href="/v2/dev/unitTest/1_intro.html" class="nav-link">单元测试</a></li>
      <li><a href="/v2/dev/deploy/1_intro.html" class="nav-link">构建和部署</a></li>
      <li><a href="/v2/dev/serverOprate/1_intro.html" class="nav-link">服务器操作</a></li>
    </ul>
  </li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">运行</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/runtime/browser/1_intro.html" class="nav-link">浏览器</a></li>
    <li><a href="/v2/runtime/app/1_intro.html" class="nav-link">app</a></li>
    <li><a href="/v2/runtime/desktop/1_intro.html" class="nav-link">桌面</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">监控</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/monitor/browser/1_intro.html" class="nav-link">浏览器</a></li>
    <li><a href="/v2/monitor/app/1_intro.html" class="nav-link">app</a></li>
    <li><a href="/v2/monitor/desktop/1_intro.html" class="nav-link">桌面</a></li>
  </ul>
</li>
<!-- <li class="nav-dropdown-container learn">
	<a class="nav-link">v2</a><span class="arrow"></span>
  <ul class="nav-dropdown">
		<li><h4>理论</h4></li>
		<li><ul>
			<li><a href="/v2/theory/dataStructure/1_intro.html" class="nav-link">数据结构</a></li>
			<li><a href="/v2/theory/computerNet/1_intro.html" class="nav-link">计算机网络</a></li>
			<li><a href="/v2/theory/computerContain/1_intro.html" class="nav-link">计算机组成原理</a></li>
			<li><a href="/v2/theory/arithmeticV2/1_intro.html" class="nav-link">算法</a></li>
			<li><a href="/v2/theory/compile/1_intro.html" class="nav-link">编译原理</a></li>
		</ul></li>
		<li><h4>基础</h4></li>
    <li><ul>
			<li><a href="/v2/basic/frontend/1_intro.html" class="nav-link">前端</a></li>
			<li><a href="/v2/basic/http/1_intro.html" class="nav-link">http</a></li>
			<li><a href="/v2/basic/backend/1_intro.html" class="nav-link">后端</a></li>
		</ul></li>
		<li><h4>框架&工具</h4></li>
		<li><ul>
			<li><a href="/v2/frame/react/1_intro.html" class="nav-link">React相关</a></li>
			<li><a href="/v2/theory/vue/1_intro.html" class="nav-link">Vue相关</a></li>
			<li><a href="/v2/theory/lodash/1_intro.html" class="nav-link">Lodash</a></li>
			<li><a href="/v2/theory/axios/1_intro.html" class="nav-link">axios</a></li>
		</ul></li>
		<li><h4>开发环境</h4></li>
		<li><ul>
			<li><a href="/v2/dev/ide/1_intro.html" class="nav-link">IDE</a></li>
			<li><a href="/v2/dev/codeManage/1_intro.html" class="nav-link">代码管理</a></li>
			<li><a href="/v2/dev/packTools/1_intro.html" class="nav-link">打包工具</a></li>
			<li><a href="/v2/dev/staging/1_intro.html" class="nav-link">脚手架</a></li>
			<li><a href="/v2/dev/debug/1_intro.html" class="nav-link">debug</a></li>
			<li><a href="/v2/dev/unitTest/1_intro.html" class="nav-link">单元测试</a></li>
			<li><a href="/v2/dev/deploy/1_intro.html" class="nav-link">构建和部署</a></li>
			<li><a href="/v2/dev/serverOprate/1_intro.html" class="nav-link">服务器操作</a></li>
		</ul></li>
		<li><h4>运行环境</h4></li>
		<li><ul>
			<li><a href="/v2/runtime/browser/1_intro.html" class="nav-link">浏览器</a></li>
			<li><a href="/v2/runtime/app/1_intro.html" class="nav-link">app</a></li>
			<li><a href="/v2/runtime/desktop/1_intro.html" class="nav-link">桌面</a></li>
		</ul></li>
		<li><h4>监控&分析</h4></li>
		<li><ul>
			<li><a href="/v2/monitor/browser/1_intro.html" class="nav-link">浏览器</a></li>
			<li><a href="/v2/monitor/app/1_intro.html" class="nav-link">app</a></li>
			<li><a href="/v2/monitor/desktop/1_intro.html" class="nav-link">桌面</a></li>
		</ul></li>
		<li class="nav-dropdown-container learn">
			<a href="/special/1_原型.html" class="nav-link">专题</a>
		</li>			
  </ul>
</li>
 -->

<!-- v1 directory -->
<li class="nav-dropdown-container learn">
  <a class="nav-link">v1</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>软件工程化</h4></li>
    <li><ul>
      <li><a href="/software/engineering.html" class="nav-link">概念&实践</a></li>
    </ul></li>
    <li><h4>前端</h4></li>
    <li><ul>
      <li><a href="/frontend/skeleton/1_skeleton.html" class="nav-link">skeleton</a></li>
      <li><a href="/frontend/html/1_define.html" class="nav-link">html</a></li>
      <li><a href="/frontend/css/1_define.html" class="nav-link">css</a></li>
      <li><a href="/frontend/js/1_enter&going.html" class="nav-link">javascript</a></li>
      <li><a href="/frontend/framework/1_vue.html" class="nav-link">framework</a></li>
      <li><a href="/frontend/browser/1_safe.html" class="nav-link">browser</a></li>
      <li><a href="/frontend/important/1_conclude.html" class="nav-link">conclude</a></li>
    </ul></li>
    <li><h4>后端</h4></li>
    <li><ul>
      <li><a href="/backend/node/note.html" class="nav-link">node</a></li>
      <li><a href="/backend/http/1_http.html" class="nav-link">http</a></li>
      <li><a href="/backend/java/core.html" class="nav-link">java</a></li>
      <li><a href="/backend/database/1_mysql.html" class="nav-link">database</a></li>
    </ul></li>
    <li><h4>算法</h4></li>
    <li><ul>
      <li><a href="/arithmetic/1_lintcode.html" class="nav-link">概念&实践</a></li>
    </ul></li>
    <li><h4>读书</h4></li>
    <li><ul>
      <li><a href="/books/memory/1_利玛窦的记忆宫殿.html" class="nav-link">记忆学</a></li>
      <li><a href="/books/computer/1_构建高性能web网站.html" class="nav-link">计算机</a></li>
      <li><a href="/books/history/资治通鉴/1_周纪一.html" class="nav-link">历史</a></li>
      <li><a href="/books/economics/1_国富论.html" class="nav-link">经济</a></li>
    </ul></li>
  </ul>
</li>

  </ul>
</div>
  
    <div id="main" class="fix-sidebar">
        <div class="guide-links">
  
  
    <span style="float: right;"><a style="color: green;" href="/v3/server/2-arithmetic.html">算法</a> →</span>
  
  
  
    <span style="float: right; margin-right: 30px;">← <a style="color: goldenrod;" href="/v3/server/index.html">介绍</a></span>
  
</div>

  <div class="sidebar">
  <div class="sidebar-inner">
    <h3>当前位置：v3/server</h3>
    <div class="list">
      <ul class="menu-root">
  
    
      <li>
        <a href="/v3/server/index.html" class="sidebar-link">
          介绍
        </a>
      </li>
      
    
      <li>
        <a href="/v3/server/1-node.html" class="sidebar-link current">
          node
        </a>
      </li>
      
    
      <li>
        <a href="/v3/server/2-arithmetic.html" class="sidebar-link">
          算法
        </a>
      </li>
      
    
      <li>
        <a href="/v3/server/3-database.html" class="sidebar-link">
          数据库
        </a>
      </li>
      
</ul>
    </div>
    <h3>浏览其它</h3>
    <ul class="main-menu">
      <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>

<!-- v3 directory -->
<!-- <li class="nav-dropdown-container learn">
  <a href="/v3/client/index.html" class="nav-link">客户端</a>
</li>

<li class="nav-dropdown-container learn">
  <a href="/v3/http/index.html" class="nav-link">HTTP</a>
</li>

<li class="nav-dropdown-container learn">
  <a href="/v3/server/index.html" class="nav-link">服务端</a>
</li>
 -->

<!-- v2 directory -->
<li class="nav-dropdown-container learn">
  <a class="nav-link">理论</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/theory/dataStructure/1_intro.html" class="nav-link">数据结构</a></li>
    <li><a href="/v2/theory/computerNet/1_intro.html" class="nav-link">计算机网络</a></li>
    <li><a href="/v2/theory/computerContain/1_intro.html" class="nav-link">计算机组成原理</a></li>
    <li><a href="/v2/theory/arithmeticV2/1_intro.html" class="nav-link">算法</a></li>
    <li><a href="/v2/theory/compile/1_intro.html" class="nav-link">编译原理</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">基础</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/basic/frontend/1_intro.html" class="nav-link">前端</a></li>
    <li><a href="/v2/basic/http/1_intro.html" class="nav-link">http</a></li>
    <li><a href="/v2/basic/backend/1_intro.html" class="nav-link">后端</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">框架</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/frame/react/1_intro.html" class="nav-link">React相关</a></li>
    <li><a href="/v2/theory/vue/1_intro.html" class="nav-link">Vue相关</a></li>
    <li><a href="/v2/theory/lodash/1_intro.html" class="nav-link">Lodash</a></li>
    <li><a href="/v2/theory/axios/1_intro.html" class="nav-link">axios</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
    <a class="nav-link">开发</a><span class="arrow"></span>
    <ul class="nav-dropdown">
      <li><a href="/v2/dev/ide/1_intro.html" class="nav-link">IDE</a></li>
      <li><a href="/v2/dev/codeManage/1_intro.html" class="nav-link">代码管理</a></li>
      <li><a href="/v2/dev/packTools/1_intro.html" class="nav-link">打包工具</a></li>
      <li><a href="/v2/dev/staging/1_intro.html" class="nav-link">脚手架</a></li>
      <li><a href="/v2/dev/debug/1_intro.html" class="nav-link">debug</a></li>
      <li><a href="/v2/dev/unitTest/1_intro.html" class="nav-link">单元测试</a></li>
      <li><a href="/v2/dev/deploy/1_intro.html" class="nav-link">构建和部署</a></li>
      <li><a href="/v2/dev/serverOprate/1_intro.html" class="nav-link">服务器操作</a></li>
    </ul>
  </li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">运行</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/runtime/browser/1_intro.html" class="nav-link">浏览器</a></li>
    <li><a href="/v2/runtime/app/1_intro.html" class="nav-link">app</a></li>
    <li><a href="/v2/runtime/desktop/1_intro.html" class="nav-link">桌面</a></li>
  </ul>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link">监控</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/v2/monitor/browser/1_intro.html" class="nav-link">浏览器</a></li>
    <li><a href="/v2/monitor/app/1_intro.html" class="nav-link">app</a></li>
    <li><a href="/v2/monitor/desktop/1_intro.html" class="nav-link">桌面</a></li>
  </ul>
</li>
<!-- <li class="nav-dropdown-container learn">
	<a class="nav-link">v2</a><span class="arrow"></span>
  <ul class="nav-dropdown">
		<li><h4>理论</h4></li>
		<li><ul>
			<li><a href="/v2/theory/dataStructure/1_intro.html" class="nav-link">数据结构</a></li>
			<li><a href="/v2/theory/computerNet/1_intro.html" class="nav-link">计算机网络</a></li>
			<li><a href="/v2/theory/computerContain/1_intro.html" class="nav-link">计算机组成原理</a></li>
			<li><a href="/v2/theory/arithmeticV2/1_intro.html" class="nav-link">算法</a></li>
			<li><a href="/v2/theory/compile/1_intro.html" class="nav-link">编译原理</a></li>
		</ul></li>
		<li><h4>基础</h4></li>
    <li><ul>
			<li><a href="/v2/basic/frontend/1_intro.html" class="nav-link">前端</a></li>
			<li><a href="/v2/basic/http/1_intro.html" class="nav-link">http</a></li>
			<li><a href="/v2/basic/backend/1_intro.html" class="nav-link">后端</a></li>
		</ul></li>
		<li><h4>框架&工具</h4></li>
		<li><ul>
			<li><a href="/v2/frame/react/1_intro.html" class="nav-link">React相关</a></li>
			<li><a href="/v2/theory/vue/1_intro.html" class="nav-link">Vue相关</a></li>
			<li><a href="/v2/theory/lodash/1_intro.html" class="nav-link">Lodash</a></li>
			<li><a href="/v2/theory/axios/1_intro.html" class="nav-link">axios</a></li>
		</ul></li>
		<li><h4>开发环境</h4></li>
		<li><ul>
			<li><a href="/v2/dev/ide/1_intro.html" class="nav-link">IDE</a></li>
			<li><a href="/v2/dev/codeManage/1_intro.html" class="nav-link">代码管理</a></li>
			<li><a href="/v2/dev/packTools/1_intro.html" class="nav-link">打包工具</a></li>
			<li><a href="/v2/dev/staging/1_intro.html" class="nav-link">脚手架</a></li>
			<li><a href="/v2/dev/debug/1_intro.html" class="nav-link">debug</a></li>
			<li><a href="/v2/dev/unitTest/1_intro.html" class="nav-link">单元测试</a></li>
			<li><a href="/v2/dev/deploy/1_intro.html" class="nav-link">构建和部署</a></li>
			<li><a href="/v2/dev/serverOprate/1_intro.html" class="nav-link">服务器操作</a></li>
		</ul></li>
		<li><h4>运行环境</h4></li>
		<li><ul>
			<li><a href="/v2/runtime/browser/1_intro.html" class="nav-link">浏览器</a></li>
			<li><a href="/v2/runtime/app/1_intro.html" class="nav-link">app</a></li>
			<li><a href="/v2/runtime/desktop/1_intro.html" class="nav-link">桌面</a></li>
		</ul></li>
		<li><h4>监控&分析</h4></li>
		<li><ul>
			<li><a href="/v2/monitor/browser/1_intro.html" class="nav-link">浏览器</a></li>
			<li><a href="/v2/monitor/app/1_intro.html" class="nav-link">app</a></li>
			<li><a href="/v2/monitor/desktop/1_intro.html" class="nav-link">桌面</a></li>
		</ul></li>
		<li class="nav-dropdown-container learn">
			<a href="/special/1_原型.html" class="nav-link">专题</a>
		</li>			
  </ul>
</li>
 -->

<!-- v1 directory -->
<li class="nav-dropdown-container learn">
  <a class="nav-link">v1</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>软件工程化</h4></li>
    <li><ul>
      <li><a href="/software/engineering.html" class="nav-link">概念&实践</a></li>
    </ul></li>
    <li><h4>前端</h4></li>
    <li><ul>
      <li><a href="/frontend/skeleton/1_skeleton.html" class="nav-link">skeleton</a></li>
      <li><a href="/frontend/html/1_define.html" class="nav-link">html</a></li>
      <li><a href="/frontend/css/1_define.html" class="nav-link">css</a></li>
      <li><a href="/frontend/js/1_enter&going.html" class="nav-link">javascript</a></li>
      <li><a href="/frontend/framework/1_vue.html" class="nav-link">framework</a></li>
      <li><a href="/frontend/browser/1_safe.html" class="nav-link">browser</a></li>
      <li><a href="/frontend/important/1_conclude.html" class="nav-link">conclude</a></li>
    </ul></li>
    <li><h4>后端</h4></li>
    <li><ul>
      <li><a href="/backend/node/note.html" class="nav-link">node</a></li>
      <li><a href="/backend/http/1_http.html" class="nav-link">http</a></li>
      <li><a href="/backend/java/core.html" class="nav-link">java</a></li>
      <li><a href="/backend/database/1_mysql.html" class="nav-link">database</a></li>
    </ul></li>
    <li><h4>算法</h4></li>
    <li><ul>
      <li><a href="/arithmetic/1_lintcode.html" class="nav-link">概念&实践</a></li>
    </ul></li>
    <li><h4>读书</h4></li>
    <li><ul>
      <li><a href="/books/memory/1_利玛窦的记忆宫殿.html" class="nav-link">记忆学</a></li>
      <li><a href="/books/computer/1_构建高性能web网站.html" class="nav-link">计算机</a></li>
      <li><a href="/books/history/资治通鉴/1_周纪一.html" class="nav-link">历史</a></li>
      <li><a href="/books/economics/1_国富论.html" class="nav-link">经济</a></li>
    </ul></li>
  </ul>
</li>

    </ul>
  </div>
</div>


<div class="content v3/server with-sidebar ">
  <ul class="menu-root">
  
</ul>
  
    <h1>node</h1>
  
  <blockquote>
<p><a href="https://blog.csdn.net/cs380637384/article/details/82702106" target="_blank" rel="noopener">浏览器访问404</a><br><a href="https://juejin.im/post/5bbedfca5188255c5e670682" target="_blank" rel="noopener">ssr</a></p>
</blockquote>
<h2 id="浏览器访问404"><a href="#浏览器访问404" class="headerlink" title="浏览器访问404"></a>浏览器访问404</h2><ol>
<li>这是因为浏览器访问的后端地址没有对应的后端路由。</li>
<li>可以通过将访问的地址都指向前端静态资源上，也就是直接给浏览器前端首页资源。</li>
<li>浏览器获取到静态资源后，会根据路由自动匹配相应的组件，从而接管应用。</li>
</ol>
<h2 id="为什么node是单线程异步非阻塞的"><a href="#为什么node是单线程异步非阻塞的" class="headerlink" title="为什么node是单线程异步非阻塞的"></a>为什么node是单线程异步非阻塞的</h2><ol>
<li>js执行线程是单线程，把需要做的I/O交给libuv，自己马上返回做别的事情，然后libuv在指定的时刻回调就行了。</li>
<li></li>
</ol>
<h2 id="为什么node不适合CPU密集型"><a href="#为什么node不适合CPU密集型" class="headerlink" title="为什么node不适合CPU密集型"></a>为什么node不适合CPU密集型</h2><ol>
<li>单线程，执行CPU密集的任务会阻塞后续代码。</li>
<li>无法充分利用CPU多核资源。</li>
<li>利用多进程可以缓解，提供了child_process模块和cluster模块。</li>
</ol>
<h2 id="route问题"><a href="#route问题" class="headerlink" title="route问题"></a>route问题</h2><p>/test === /:id<br>这两个路由不能同时存在，会出错</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul>
<li>基于V8的javascript运行时，事件驱动、非阻塞、轻量、高效。</li>
<li>服务端js解释器，用于方便的搭建响应速度块、易于扩展的网络应用。node.js使用事件驱动，非阻塞I/O模型而得以轻量和高效，非常适合在分布式设备上运行数据密集型的实时应用。</li>
<li>一个可以让js运行在浏览器之外的平台。实现了诸如文件系统、模块、包、操作系统API、网络通信等Core JavaScript没有或者不完善的功能。</li>
</ul>
<h3 id="基础架构"><a href="#基础架构" class="headerlink" title="基础架构"></a>基础架构</h3><p>示意图：<br><img src="../../images/node.png" alt="node"></p>
<ul>
<li>最底层是Node.js依赖的各种库，有V8、libuv等</li>
<li>中间层是各种Binding，也就是胶水代码</li>
<li>最上层是应用代码，可使用Node.js的各种API</li>
</ul>
<p><img src="../../images/node_stucture.png" alt="node_stucture"></p>
<ul>
<li>Node.js 标准库，这部分是由 Javascript 编写的，即我们使用过程中直接能调用的 API。在源码中的 lib 目录下可以看到。</li>
<li>Node bindings，这一层是 Javascript 与底层 C/C++ 能够沟通的关键，前者通过 bindings 调用后者，相互交换数据。实现在 node.cc</li>
<li>这一层是支撑 Node.js 运行的关键，由 C/C++ 实现。<ul>
<li>V8：Google 推出的 Javascript VM，也是 Node.js 为什么使用的是 Javascript 的关键，它为 - - - Javascript 提供了在非浏览器端运行的环境，它的高效是 Node.js 之所以高效的原因之一。</li>
<li>Libuv：它为 Node.js 提供了跨平台，线程池，事件池，异步 I/O 等能力，是 Node.js 如此强大的关键。</li>
<li>C-ares：提供了异步处理 DNS 相关的能力。</li>
<li>http_parser、OpenSSL、zlib 等：提供包括 http 解析、SSL、数据压缩等其他的能力。</li>
</ul>
</li>
</ul>
<h4 id="V8"><a href="#V8" class="headerlink" title="V8"></a>V8</h4><p>谷歌开源的高性能js引擎，将js代码转换为机器码，然后执行，因此速度非常快。它用C++开发，谷歌的Chrome浏览器使用的就是V8引擎。Node在服务器上使用重建过后的V8引擎。</p>
<h4 id="libuv"><a href="#libuv" class="headerlink" title="libuv"></a>libuv</h4><p>用C语言开发，内部管理者一个线程池。在此基础上，提供事件循环、异步网络I/O、文件系统I/O等能力。<br>Libuv 是 Node.js 关键的一个组成部分，它为上层的 Node.js 提供了统一的 API 调用，使其不用考虑平台差距，隐藏了底层实现。</p>
<p>具体它能做什么，官网的这张图体现的很好：<br><img src="../../images/libuv.png" alt="libuv"></p>
<p>可以看出，它是一个对开发者友好的工具集，包含定时器，非阻塞的网络 I/O，异步文件系统访问，子进程等功能。它封装了 Libev、Libeio 以及 IOCP，保证了跨平台的通用性。</p>
<p>我们只要先知道它本身是异步和事件驱动的，记住这点，下面的问题就有了答案，我们一一来看。</p>
<h4 id="与操作系统的交互"><a href="#与操作系统的交互" class="headerlink" title="与操作系统的交互"></a>与操作系统的交互</h4><p>举个简单的例子，我们想要打开一个文件，并进行一些操作，可以写下面这样一段代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.open(<span class="string">'./test.txt'</span>, <span class="string">"w"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//..do something</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这段代码的调用过程大致可描述为：lib/fs.js → src/node_file.cc → uv_fs</p>
<p>Node.js 深入浅出上的一幅图：<br><img src="../../images/node_oprate.png" alt="node_oprate"></p>
<p>具体来说，当我们调用 fs.open 时，Node.js 通过 process.binding 调用 C/C++ 层面的 Open 函数，然后通过它调用 Libuv 中的具体方法 uv_fs_open，最后执行的结果通过回调的方式传回，完成流程。在图中，可以看到平台判断的流程，需要说明的是，这一步是在编译的时候已经决定好的，并不是在运行时中。</p>
<p>总体来说，我们在 Javascript 中调用的方法，最终都会通过 process.binding 传递到 C/C++ 层面，最终由他们来执行真正的操作。Node.js 即这样与操作系统进行互动。</p>
<p>通过这个过程，我们可以发现，实际上，Node.js 虽然说是用的 Javascript，但只是在开发时使用 Javascript 的语法来编写程序。真正的执行过程还是由 V8 将 Javascript 解释，然后由 C/C++ 来执行真正的系统调用，所以并不需要过分担心 Javascript 执行效率的问题。可以看出，Node.js 并不是一门语言，而是一个 平台，这点一定要分清楚。</p>
<h4 id="异步、非阻塞-I-O"><a href="#异步、非阻塞-I-O" class="headerlink" title="异步、非阻塞 I/O"></a>异步、非阻塞 I/O</h4><p>通过上文，我们了解到，真正执行系统调用的其实是 Libuv。之前我们提到，Libuv 本身就是异步和事件驱动的，所以，当我们将 I/O 操作的请求传达给 Libuv 之后，Libuv 开启线程来执行这次 I/O 调用，并在执行完成后，传回给 Javascript 进行后续处理。</p>
<p>这里面的 I/O 包括文件 I/O 和 网络 I/O。两者的底层执行略有不同。从上面的 Libuv 官网的图中，我们可以看到，文件 I/O，DNS 等操作，都是依托线程池（Thread Pool）来实现的。而网络 I/O 这一大类，包括：TCP、UDP、TTY 等，是由 epoll、IOCP、kqueue 来具体实现的。</p>
<p>总结来说，一个异步 I/O 的大致流程如下：</p>
<p>发起 I/O 调用</p>
<p>用户通过 Javascript 代码调用 Node 核心模块，将参数和回调函数传入到核心模块；<br>Node 核心模块会将传入的参数和回调函数封装成一个请求对象；<br>将这个请求对象推入到 I/O 线程池等待执行；<br>Javascript 发起的异步调用结束，Javascript 线程继续执行后续操作。<br>执行回调</p>
<p>I/O 操作完成后，会将结果储存到请求对象的 result 属性上，并发出操作完成的通知；<br>每次事件循环时会检查是否有完成的 I/O 操作，如果有就将请求对象加入到 I/O 观察者队列中，之后当做事件处理；<br>处理 I/O 观察者事件时，会取出之前封装在请求对象中的回调函数，执行这个回调函数，并将 result 当参数，以完成 Javascript 回调的目的。</p>
<h4 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h4><p>如c-ares、crypto（OpenSSL）、http-parser以及zlib。这些依赖提供了对系统底层功能的访问，包括网络、压缩、加密等。</p>
<ul>
<li>Node.js底层的依赖库，有的以C语言开发，有的以C++语言开发，如何让应用代码（js）能够与这些底层库相互调用呢，这就需要中间层Binding来完成。Binding是一些胶水代码，能够把不同语言绑定在一起使其能够互相沟通。在node.js中，binding就是把node.js那些用C/C++写的库接口暴露给js环境。</li>
<li>中间层中，除了Binding，还有Addon。Binding仅桥接Node.js核心的一些依赖，如果你想在应用程序中包含其他第三方或者你自己的C/C++库的话，需要自己完成这部分的胶水代码。你写的这部分胶水代码就称为Addon。本质上都是完成桥接的作用，使得应用和底层库能够互通。</li>
<li>应用层就是我们开发的应用、npm安装的包都运行在这里。</li>
</ul>
<h3 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h3><h4 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h4><p><img src="../../images/node-event.png" alt="node-event"></p>
<h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><ul>
<li>一个Node.js应用启动时，V8引擎会执行你写的应用代码，保持一份观察者（注册在事件上的回调函数）列表。当事件发生时，它的回调函数会被加进一个事件队列。只要这个队列还有等待执行的回调函数，事件循环就会持续把回调函数从队列中拿出并执行。</li>
<li>在回调函数执行过程中，所有的I/O请求都会转发给工作线程处理。libuv维持着一个线程池，包含四个工作流程（默认值，可配置）。文件系统I/O请求和DNS相关请求都会放进这个线程池处理；其它的请求，如网络、平台特性相关的请求会分发给相应的系统处理单元进行处理。</li>
<li>安排给线程池的这些I/O操作由Node.js的底层库执行，完成之后触发相应事件，对应的事件回调函数会被放入事件队列，等待执行后序操作。这就是一个事件在Node.js中执行的整个生命周期。</li>
<li>我们只知道Node.js有事件循环，但是不知道每次循环何时开始、何时结束。事件循环阶段图：<br><img src="../../images/node-event-loop.png" alt="node-event-loop"><blockquote>
<p>每一个方块，在事件循环中被称为一个阶段。</p>
</blockquote>
</li>
<li>每个阶段都有自己独有的一个用于执行回调函数的FIFO（先进先出）队列。当事件循环进入一个指定阶段时，会执行队列中的回调函数，当队列中已经被清空或执行的回调函数个数达到系统最大限制时，事件循环会进入下一个阶段。</li>
<li>图中的六个阶段分别为：<ul>
<li>timers：该阶段由<code>setTimeout()</code>和<code>setInterval()</code>设置的回调函数。</li>
<li>I/O callbacks：执行除了close回调、timers以及<code>setImmediate()</code>设置的回调以外的几乎所有的回调。</li>
<li>idle，prepare：仅供内部使用。</li>
<li>poll：检索新的I/O事件，在适当的时候Node.js会阻塞等待。</li>
<li>check：执行<code>setImmediate()</code>设置的回调。</li>
<li>close callbacks：执行关闭回调，<code>socket.on(&#39;close&#39;, ...)</code>。</li>
</ul>
</li>
</ul>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>Node 公开宣称的目标是 “旨在提供一种简单的构建可伸缩网络程序的方法”。我们来看一个简单的例子，在 Java™ 和 PHP 这类语言中，每个连接都会生成一个新线程，每个新线程可能需要 2 MB 的配套内存。在一个拥有 8 GB RAM 的系统上，理论上最大的并发连接数量是 4,000 个用户。随着您的客户群的增长，如果希望您的 Web 应用程序支持更多用户，那么，您必须添加更多服务器。所以在传统的后台开发中，整个 Web 应用程序架构（包括流量、处理器速度和内存速度）中的瓶颈是：服务器能够处理的并发连接的最大数量。这个不同的架构承载的并发数量是不一致的。 </li>
<li>而Node的出现就是为了解决这个问题：更改连接到服务器的方式。在Node 声称它不允许使用锁，它不会直接阻塞 I/O 调用。Node在每个连接发射一个在 Node 引擎的进程中运行的事件，而不是为每个连接生成一个新的 OS 线程（并为其分配一些配套内存）。</li>
</ul>
<p>使用为网络而生的Node.js，你可以轻易的实现：</p>
<ul>
<li>具有复杂逻辑的网站</li>
<li>基于社交网络的大规模的web应用</li>
<li>web socket 服务器</li>
<li>TCP/UDP 套接字应用程序</li>
<li>命令行工具</li>
<li>交互式终端程序</li>
<li>带有图形用户界面的本地应用程序</li>
<li>单元测试工具</li>
<li>客户端js编译器</li>
</ul>
<h3 id="事件驱动"><a href="#事件驱动" class="headerlink" title="事件驱动"></a>事件驱动</h3><p>在我们使用Java，PHP等语言实现编程的时候，我们面向对象编程是完美的编程设计，这使得他们对其他编程方法不屑一顾。却不知大名鼎鼎Node使用的却是事件驱动编程的思想。那什么是事件驱动编程。<br>事件驱动编程，为需要处理的事件编写相应的事件处理程序。代码在事件发生时执行。<br>为需要处理的事件编写相应的事件处理程序。要理解事件驱动和程序，就需要与非事件驱动的程序进行比较。实际上，现代的程序大多是事件驱动的，比如多线程的程序，肯定是事件驱动的。早期则存在许多非事件驱动的程序，这样的程序，在需要等待某个条件触发时，会不断地检查这个条件，直到条件满足，这是很浪费cpu时间的。而事件驱动的程序，则有机会释放cpu从而进入睡眠态（注意是有机会，当然程序也可自行决定不释放cpu），当事件触发时被操作系统唤醒，这样就能更加有效地使用cpu。<br>即：事件源 -&gt; 事件对象 -&gt; 事件处理程序<br>事件驱动模型主要包含3个对象：事件源、事件和事件处理程序。</p>
<p>事件源：产生事件的地方(html元素)<br>事件：点击/鼠标操作/键盘操作等等<br>事件对象：当某个事件发生时，可能会产生一个事件对象，该时间对象会封装好该时间的信息，传递给事件处理程序<br>事件处理程序：响应用户事件的代码<br>其实我们使用的window系统也算得上是事件驱动了。我们来看一个简单的事例：监听鼠标点击事件，并能够显示鼠标点击的位置x,y。</p>
<p>当我们搜索Node.js时，夺眶而出的关键字就是 “单线程，异步I/O，事件驱动”，应用程序的请求过程可以分为俩个部分：CPU运算和I/O读写，CPU计算速度通常远高于磁盘读写速度，这就导致CPU运算已经完成，但是不得不等待磁盘I/O任务完成之后再继续接下来的业务。<br>所以I/O才是应用程序的瓶颈所在，在I/O密集型业务中，假设请求需要100ms来完成，其中99ms化在I/O上。如果需要优化应用程序，让他能同时处理更多的请求，我们会采用多线程，同时开启100个、1000个线程来提高我们请求处理，当然这也是一种可观的方案。<br>但是由于一个CPU核心在一个时刻只能做一件事情，操作系统只能通过将CPU切分为时间片的方法，让线程可以较为均匀的使用CPU资源。但操作系统在内核切换线程的同时也要切换线程的上线文，当线程数量过多时，时间将会被消耗在上下文切换中。所以在大并发时，多线程结构还是无法做到强大的伸缩性。<br>那么是否可以另辟蹊径呢？！我们先来看看单线程，《深入浅出Node》一书提到 “单线程的最大好处，是不用像多线程编程那样处处在意状态的同步问题，这里没有死锁的存在，也没有线程上下文切换所带来的性能上的开销”，那么一个线程一次只能处理一个请求岂不是无稽之谈，先让我们看张图：<br><img src="../../images/node_IO.png" alt="node_IO"></p>
<p>Node.js的单线程并不是真正的单线程，只是开启了单个线程进行业务处理（cpu的运算），同时开启了其他线程专门处理I/O。当一个指令到达主线程，主线程发现有I/O之后，直接把这个事件传给I/O线程，不会等待I/O结束后，再去处理下面的业务，而是拿到一个状态后立即往下走，这就是“单线程”、“异步I/O”。<br>I/O操作完之后呢？Node.js的I/O 处理完之后会有一个回调事件，这个事件会放在一个事件处理队列里头，在进程启动时node会创建一个类似于While(true)的循环，它的每一次轮询都会去查看是否有事件需要处理，是否有事件关联的回调函数需要处理，如果有就处理，然后加入下一个轮询，如果没有就退出进程，这就是所谓的“事件驱动”。这也从Node的角度解释了什么是”事件驱动”。<br>在node.js中，事件主要来源于网络请求，文件I/O等，根据事件的不同对观察者进行了分类，有文件I/O观察者，网络I/O观察者。事件驱动是一个典型的生产者/消费者模型，请求到达观察者那里，事件循环从观察者进行消费，主线程就可以马不停蹄的只关注业务不用再去进行I/O等待。</p>
<p>这里面涉及到了 Libuv 本身的一个设计理念，事件循环（Event Loop），它是一个类似于 while true 的无限循环，其核心函数是 uv_run，下文会用到。</p>
<p>从这里，我们可以看到，我们其实对 Node.js 的单线程一直有个误会。事实上，它的单线程指的是自身 Javascript 运行环境的单线程，Node.js 并没有给 Javascript 执行时创建新线程的能力，最终的实际操作，还是通过 Libuv 以及它的事件循环来执行的。这也就是为什么 Javascript 一个单线程的语言，能在 Node.js 里面实现异步操作的原因，两者并不冲突。</p>
<h2 id="登录授权的完整流程"><a href="#登录授权的完整流程" class="headerlink" title="登录授权的完整流程"></a>登录授权的完整流程</h2><ul>
<li>登录流程<ul>
<li>无账号，去注册</li>
<li>有账号，去登录</li>
</ul>
</li>
<li>授权<ul>
<li>前端视觉限制（仅限于对内平台）</li>
<li>cookie（可以对外）</li>
<li>携带token的请求头（可以对外）</li>
<li>如果是单页应用可以放在state中</li>
</ul>
</li>
</ul>
<h2 id="exports的用法"><a href="#exports的用法" class="headerlink" title="exports的用法"></a>exports的用法</h2><h3 id="当成一个对象使用"><a href="#当成一个对象使用" class="headerlink" title="当成一个对象使用"></a>当成一个对象使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line">exports.test1 = <span class="string">'i am test1'</span></span><br><span class="line">exports.test2 = <span class="function"><span class="params">()</span> =&gt;</span> exports.test3 = <span class="string">'i am test3'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test = <span class="built_in">require</span>(<span class="string">'test.js'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(test) <span class="comment">// &#123;test1: 'i am test1', test2: [function]&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(test.test2()) <span class="comment">// i am test3</span></span><br><span class="line"><span class="built_in">console</span>.log(test) <span class="comment">// &#123;test1: 'i am test1', test2: [function], test3: 'i am test3'&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="如何使用node注册终端指令"><a href="#如何使用node注册终端指令" class="headerlink" title="如何使用node注册终端指令"></a>如何使用node注册终端指令</h2><ul>
<li><a href="https://www.npmjs.com/package/v8-compile-cache" target="_blank" rel="noopener">阮一峰</a></li>
</ul>
<h2 id="sails相关"><a href="#sails相关" class="headerlink" title="sails相关"></a>sails相关</h2><ul>
<li>换接口启动，config/env  加上port：–</li>
<li>Unhandled rejection SequelizeBaseError: Validation error数据库的unique字段有重复的数据</li>
<li>爆出一堆看不懂的错误是：接口请求错了，正常情况下不可能爆出看不懂的错误 什么unknow clomun NAN、</li>
</ul>
<h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul>
<li>entry 一个可执行模块或库的入口文件。</li>
<li>chunk 多个文件组成的一个代码块，例如把一个可执行模块和它所有依赖的模块组合成一个 chunk 这体现了webpack的打包机制。</li>
<li>loader 文件转换器，例如把es6转换为es5，scss转换为css。</li>
<li>plugin 插件，用于扩展webpack的功能，在webpack构建生命周期的节点上加入扩展hook为webpack加入功能。</li>
</ul>
<p>##3 构建流程<br>从启动webpack构建到输出结果经历了一系列过程，它们是：</p>
<ul>
<li>解析webpack配置参数，合并从shell传入和webpack.config.js文件里配置的参数，生产最后的配置结果。</li>
<li>注册所有配置的插件，好让插件监听webpack构建生命周期的事件节点，以做出对应的反应。</li>
<li>从配置的entry入口文件开始解析文件构建AST语法树，找出每个文件所依赖的文件，递归下去。</li>
<li>在解析文件递归的过程中根据文件类型和loader配置找出合适的loader用来对文件进行转换。</li>
<li>递归完后得到每个文件的最终结果，根据entry配置生成代码块chunk。</li>
<li>输出所有chunk到文件系统。</li>
</ul>
<blockquote>
<p>需要注意的是，在构建生命周期中有一系列插件在合适的时机做了合适的事情，比如UglifyJsPlugin会在loader转换递归完后对结果再使用UglifyJs压缩覆盖之前的结果。</p>
</blockquote>
<p>##3 如何生成不同格式的文件<br>使用node的writeFile模块来生成不同格式的文件。</p>
<h3 id="import-error"><a href="#import-error" class="headerlink" title="import error"></a>import error</h3><p>Unknown custom element: <code>&lt;search-form&gt;</code> - did you register the component correctly? For recursive components, make sure to provide the “name” option:<br><code>import xx from &#39;xx&#39;</code> 而不是 <code>import {xx} from &#39;xx&#39;</code></p>
<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>在webpack中使用各种<code>loader</code>对文件进行预处理，达到适配各种中断的需求。</p>
<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><p>可以使用<code>postcss</code>对编译过后的sass、less等进行样式补全，即一行代码适应多个浏览器</p>
<h3 id="webpack对页面性能的优化"><a href="#webpack对页面性能的优化" class="headerlink" title="webpack对页面性能的优化"></a>webpack对页面性能的优化</h3><blockquote>
<p><a href="https://segmentfault.com/a/1190000004577578" target="_blank" rel="noopener">segmentfault1</a></p>
</blockquote>
<blockquote>
<p><a href="https://segmentfault.com/a/1190000007891318" target="_blank" rel="noopener">segmentfault2</a></p>
</blockquote>
<blockquote>
<p><a href="https://github.com/hawx1993/tech-blog/issues/3" target="_blank" rel="noopener">github</a></p>
</blockquote>

  <div class="guide-links">
    
    
      <span>← <a href="/v3/server/index.html">介绍</a></span>
    
    
    
      <span style="float: right;"><a href="/v3/server/2-arithmetic.html">算法</a> →</span>
    
  </div>
  <div class="footer">
    发现错误？想参与编辑？
    <a href="https://github.com/mallow-fight/blog/tree/master/source/v3/server/1-node.md" target="_blank">
      在 GitHub 上编辑此页！
    </a>
    
    <span>更新于：2019-06-03 18:06:81</span>
  </div>
</div>


<!-- <div id="disqus_thread"></div>
<script>
  // it seems slowly page, so i annotation it.
  // disqus评论系统
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
    this.page.url = 'https://mallow-fight.github.io/';  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = 'https://mallow-fight.github.io/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://mallow-blog.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->
    </div>
    <script src="/js/smooth-scroll.min.js"></script>
  
  <!-- main custom script for sidebars, version selects etc. -->
  <script src="/js/css.escape.js"></script>
  <script src="/js/common.js"></script>
  <!-- search -->
  <link href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/search.css">
  <script src="/js/docsearch.js"></script>
  <script>
  [
    '#search-query-nav',
    '#search-query-sidebar',
    '#search-query-menu'
  ].forEach(function (selector) {
    if (!document.querySelector(selector)) return
    docsearch({
      appId: 'FKZQZEMOI4',
      apiKey: '82fdcfac2e888595cb2807aa60aaad58',
      indexName: 'prod_blog',
      inputSelector: selector
    })
  })
  </script>
  <!-- fastclick -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
</body>
</html>